.. _apps-pmwiki:

PmWiki
======
`PmWiki`_ is a wiki-based system for collaborative creation and maintenance of websites.

Requirements
------------
*Version:*
	1.4.7 or >

Recipe
----------
The configuration uses a separated, reusable layout. It adds three files.

.. ngx::

	# /etc/nginx/conf.d/servers.conf
	# Renich Bon Ciric <renich@evalinux.com>
	include server.d/*.conf;

.. ngx::
	# /etc/nginx/server.d/wiki.example.tld.conf
	# Renich Bon Ciric <renich@evalinux.com>
	server {
		listen 80;
		listen 443 ssl;
		server_name wiki.example.tld;
		root /srv/www/pmwiki/example.tld/wiki/public;

		include include.d/pmwiki.conf;
		include include.d/common.conf;

		error_log /var/log/nginx/wiki.example.tld-error.log;
	}

.. ngx::

	# /etc/nginx/include.d/pmwiki.conf
	# PmWiki
	# Renich Bon Ciric <renich@woralelandia.com>
	 
	## index
	index pmwiki.php;
	  
	## deny
	location ~ ^/(cookbook|local|scripts|wiki.d|wikilib.d) {
		deny all;
	}
	   
	## rewrite
	location / { 
		try_files $uri $uri/ @pmwiki; 
	} 

	location @pmwiki { 
		rewrite ^/(.*) /pmwiki.php?n=$1; 
	}

	## php
		location ~ \.php$ {
		include /etc/nginx/fastcgi_params;
		fastcgi_pass unix:/run/php-fpm/php-fpm.sock;
	}

.. ngx::

	# /etc/nginx/include.d/common.conf
	# Common configuration
	 
	# cache
	location ~* \.(?:ico|css|js|gif|jpe?g|png)$ {
		# Some basic cache-control for static files to be sent to the browser
		expires max;
		add_header Pragma public;
		add_header Cache-Control "public, must-revalidate, proxy-revalidate";
	}
	 
	# drop
	location = /robots.txt { access_log off; log_not_found off; }
	location = /favicon.ico { access_log off; log_not_found off; }
	location ~ /\. { access_log off; log_not_found off; allow all; }
	location ~ ~$ { access_log off; log_not_found off; deny all; }
	 
	# log
	access_log /var/log/nginx/${host}-access.log;

Notes
-----
* I've used php-fpm in socket mode. Please, go here for more info: 
  http://www.php.net/manual/en/install.fpm.configuration.php#listen
* The distributed configuration is not a must. You can synthesize all of it into a
  single file. You will use the ability to re-use it, though.

Contributors
------------
* Renich @ irc.freenode.net/#fedora
* kolbyjack @ irc.freenode.net/#nginx

References
----------
* `PmWiki's Clean Urls`_

.. _PmWiki's Clean Urls: http://www.pmwiki.org/wiki/Cookbook/CleanUrls
.. _PmWiki: http://www.pmwiki.org/

..
	/* vim: set tabstop=4 shiftwidth=4 textwidth=80: */ 
	/* vim: set nowrap autoindent smartindent smarttab: */
